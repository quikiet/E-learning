<p-toast></p-toast>
<div class="max-w-3xl mx-auto my-10 p-6 bg-white shadow-md rounded-lg">
  <h2 class="text-2xl font-bold mb-6">Tạo khóa học mới</h2>
  <form (ngSubmit)="createCourse()" #courseForm="ngForm">
    <div class="mb-4">
      <label for="course_name" class="block text-sm font-medium text-gray-700"
        >Tên khóa học</label
      >
      <input
        type="text"
        id="course_name"
        name="course_name"
        [(ngModel)]="course.course_name"
        required
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md"
      />
    </div>
    <div class="mb-4">
      <label
        for="difficulty_level"
        class="block text-sm font-medium text-gray-700"
        >Mức độ khó</label
      >
      <select
        id="difficulty_level"
        name="difficulty_level"
        [(ngModel)]="course.difficulty_level"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md"
      >
        <option value="Beginner">Beginner</option>
        <option value="Intermediate">Intermediate</option>
        <option value="Advanced">Advanced</option>
      </select>
    </div>
    <div class="mb-4">
      <label
        for="course_description"
        class="block text-sm font-medium text-gray-700"
        >Mô tả khóa học</label
      >
      <textarea
        id="course_description"
        name="course_description"
        [(ngModel)]="course.course_description"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md"
        rows="4"
      ></textarea>
    </div>
    <div class="mb-4">
      <label for="skills" class="block text-sm font-medium text-gray-700"
        >Kỹ năng</label
      >
      <input
        type="text"
        id="skills"
        name="skills"
        [(ngModel)]="course.skills"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md"
      />
    </div>
    <div class="mb-4">
      <label for="price" class="block text-sm font-medium text-gray-700"
        >Giá khóa học (VND)</label
      >
      <input
        type="number"
        id="price"
        name="price"
        [(ngModel)]="course.price"
        required
        min="0"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md"
      />
    </div>
    <div class="mb-4">
      <label for="image" class="block text-sm font-medium text-gray-700"
        >Thumbnail</label
      >
      <input
        type="file"
        id="image"
        name="image"
        (change)="onImageSelected($event)"
        accept="image/*"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md"
      />
    </div>
    <div class="mb-4 flex items-center justify-between">
      <div>
        <label
          for="category_ids"
          class="block text-sm font-medium text-gray-700"
          >Danh mục</label
        >
        <p-multiSelect
          [options]="categories"
          [(ngModel)]="selectedCategories"
          optionLabel="name"
          optionValue="id"
          placeholder="Chọn danh mục"
          class="w-full md:w-56"
          name="category_ids"
          required
          #categoryIds="ngModel"
          (onChange)="onCategoryChange($event)"
        ></p-multiSelect>
        <div
          *ngIf="courseForm.submitted && categoryIds.invalid"
          class="text-red-500 text-sm mt-1"
        >
          Vui lòng chọn ít nhất một danh mục.
        </div>
      </div>
      <div class="mb-6 flex items-center">
        <input
          type="checkbox"
          name="is_certificate_enabled"
          (click)="openCertify()"
          [(ngModel)]="course.is_certificate_enabled"
          class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
        />
        <label
          for="is_certificate_enabled"
          class="ml-2 text-sm font-medium text-gray-700"
        >
          Certificate
        </label>
      </div>
    </div>

    <div class="space-y-4" *ngIf="showCertificateModal">
      <div class="flex flex-col gap-2">
        <label
          for="lessonCompletionPercent"
          class="text-sm font-medium text-gray-700"
          >Phần trăm hoàn thành bài học (%):</label
        >
        <input
          id="lessonCompletionPercent"
          type="number"
          pInputText
          [(ngModel)]="certificateRule.lesson_completion_percent"
          name="lesson_completion_percent"
          placeholder="Nhập phần trăm (e.g., 85)"
          class="w-full"
        />
      </div>
      <div class="flex flex-col gap-2">
        <label for="quizMinScore" class="text-sm font-medium text-gray-700"
          >Điểm tối thiểu quiz (%):</label
        >
        <input
          id="quizMinScore"
          type="number"
          pInputText
          [(ngModel)]="certificateRule.quiz_min_score"
          placeholder="Nhập điểm tối thiểu (e.g., 70)"
          name="quiz_min_score"
          class="w-full"
        />
      </div>
      <div class="flex flex-col gap-2">
        <label for="lessonVersionRule" class="text-sm font-medium text-gray-700"
          >Quy tắc phiên bản bài học:</label
        >
        <p-dropdown
          id="lessonVersionRule"
          [(ngModel)]="certificateRule.lesson_version_rule"
          name="lesson_version_rule"
          [options]="versionRuleOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="Chọn quy tắc"
          class="w-full"
        />
      </div>
      <div class="flex flex-col gap-2">
        <label for="quizVersionRule" class="text-sm font-medium text-gray-700"
          >Quy tắc phiên bản quiz:</label
        >
        <p-dropdown
          id="quizVersionRule"
          [(ngModel)]="certificateRule.quiz_version_rule"
          [options]="versionRuleOptions"
          name="quiz_version_rule"
          optionLabel="label"
          optionValue="value"
          placeholder="Chọn quy tắc"
          class="w-full"
        />
      </div>
    </div>

    <button
      type="submit"
      [disabled]="!courseForm.valid"
      class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"
    >
      Gửi khóa học
    </button>
  </form>
</div>
